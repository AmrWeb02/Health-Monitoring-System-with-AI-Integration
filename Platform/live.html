<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SHA</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" type="text/css" href="loading-bar.css"/>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="gridcontainer">
    <div class="header">
      <img src="r1.png">
      <h2>Dashboard</h2>
      <a href="">FAQ</a>
    </div>
    <div class="spo2card">

      <div class="card front">
        <div class="ldBar label-center" id="myItem3" data-value="10" data-max="200" data-type="stroke" data-stroke="red" data-stroke-width="8" data-path="M90.5,23.2c0-12.5-10.2-22.7-22.7-22.7
        c-13.6,0-20.9,8.6-22.3,13.8C44.3,8.9,
        35.1,0.5,23.2,0.5C10.7,0.5,0.5,10.7,
        0.5,23.2c0,22.2,36.5,45.3,45,55.9
        C53.5,67.3,90.5,46.3,90.5,23.2z">
        </div>
        <h3>Heart Rate</h3>
      </div>
      <div class="back face">
        <svg width="38pt" height="35pt" viewBox="0 0 38 35" xmlns="http://www.w3.org/2000/svg"><g id="fontsvg1712329858766" stroke-linecap="round" fill-rule="evenodd" fill="#ff0000"><path d="M 35.01 3.076 L 35.01 3.125 Q 33.789 1.66 32.08 0.879 A 9.446 9.446 0 0 0 29.877 0.195 A 12.513 12.513 0 0 0 28.125 0 A 10.071 10.071 0 0 0 26.238 0.168 A 7.324 7.324 0 0 0 24.17 0.879 A 10.038 10.038 0 0 0 21.24 3.125 Q 20.343 4.172 19.761 4.875 A 55.67 55.67 0 0 0 19.434 5.274 Q 18.813 6.037 18.753 6.241 A 0.214 0.214 0 0 0 18.75 6.25 A 0.536 0.536 0 0 0 18.708 6.147 Q 18.582 5.896 18.115 5.274 A 31.774 31.774 0 0 0 17.761 4.846 Q 17.175 4.151 16.26 3.125 Q 15.039 1.758 13.428 0.879 A 7.217 7.217 0 0 0 11.489 0.2 Q 10.637 0.025 9.657 0.003 A 12.676 12.676 0 0 0 9.375 0 A 12.196 12.196 0 0 0 7.294 0.262 A 9.26 9.26 0 0 0 5.42 0.879 A 8.221 8.221 0 0 0 2.49 3.125 A 10.575 10.575 0 0 0 1.225 4.929 A 8.964 8.964 0 0 0 0.684 6.104 Q 0.049 7.666 0 9.375 Q 0 10.395 0.238 12.095 A 46.954 46.954 0 0 0 0.342 12.793 A 14.1 14.1 0 0 0 0.896 14.919 Q 1.352 16.256 2.1 17.725 Q 2.783 19.043 4.15 20.752 Q 5.518 22.51 7.568 24.561 A 86.902 86.902 0 0 0 9.801 26.71 Q 11.038 27.862 12.451 29.102 Q 15.234 31.592 18.75 34.375 A 188.284 188.284 0 0 0 22.083 31.677 A 141.323 141.323 0 0 0 25.049 29.151 Q 27.832 26.709 29.883 24.61 Q 31.982 22.51 33.35 20.801 A 23.59 23.59 0 0 0 34.3 19.58 Q 34.727 18.989 35.052 18.446 A 10.883 10.883 0 0 0 35.449 17.725 Q 36.484 15.578 36.917 13.762 A 12.383 12.383 0 0 0 37.109 12.793 A 42.732 42.732 0 0 0 37.28 11.737 Q 37.446 10.616 37.487 9.84 A 8.953 8.953 0 0 0 37.5 9.375 Q 37.451 7.666 36.865 6.104 A 10.857 10.857 0 0 0 35.715 4.001 A 13.205 13.205 0 0 0 35.01 3.076 Z" vector-effect="non-scaling-stroke"/></g></svg>
        <h2>When to seek medical attention</h2>
        <ul>
          <li>If your SpO2 reading falls below 92% consistently.</li>
          <li>You experience shortness of breath, dizziness, or chest pain.</li>
        </ul>
      </div>
    
    </div>
    
    <div class="heartcard">
    
      <div class="card front">
        <div class="ldBar label-center" id="myItem2" data-preset="circle" data-value="20" data-max="100"></div>
        <h3>Oxygen Saturation</h3>
      </div>
      <div class="back face">
        <svg width="76pt" height="42pt" viewBox="0 0 76 42" xmlns="http://www.w3.org/2000/svg"><g id="fontsvg1712330246312" stroke-linecap="round" fill-rule="evenodd" fill="#ff0000"><path d="M 11.084 24.316 L 0 24.365 L 0 28.906 L 11.426 28.906 A 6.007 6.007 0 0 0 12.694 28.782 Q 13.432 28.622 13.971 28.257 A 2.926 2.926 0 0 0 14.893 27.246 L 15.283 26.514 L 19.189 38.525 A 4.107 4.107 0 0 0 20.557 40.527 Q 21.436 41.211 22.51 41.309 A 3.352 3.352 0 0 0 22.662 41.312 A 2.809 2.809 0 0 0 24.414 40.723 A 2.967 2.967 0 0 0 25.37 39.504 A 4.27 4.27 0 0 0 25.635 38.672 L 30.127 17.529 L 34.131 36.328 A 9.315 9.315 0 0 0 34.464 37.486 Q 34.992 38.928 35.889 39.502 A 3.255 3.255 0 0 0 36.855 39.921 Q 37.197 40.004 37.551 40.004 A 3.068 3.068 0 0 0 37.842 39.99 Q 38.916 39.844 39.697 39.063 Q 40.527 38.281 40.918 36.084 L 45.117 11.328 L 49.414 36.475 A 278.464 278.464 0 0 0 49.482 36.881 Q 49.608 37.628 49.651 37.855 A 4.557 4.557 0 0 0 49.658 37.891 A 4.043 4.043 0 0 0 50.092 38.909 A 3.258 3.258 0 0 0 50.879 39.795 A 2.911 2.911 0 0 0 52.783 40.479 A 3.379 3.379 0 0 0 54.099 40.226 A 3.209 3.209 0 0 0 54.834 39.795 A 3.636 3.636 0 0 0 55.957 37.939 L 59.668 23.682 L 59.961 25.342 Q 60.254 27.197 61.084 28.027 Q 62.012 28.906 63.281 28.906 L 75.293 28.906 L 75.293 24.365 L 64.453 24.365 L 63.184 16.748 Q 62.816 14.541 60.846 14.023 A 4.284 4.284 0 0 0 60.596 13.965 A 3.857 3.857 0 0 0 60.052 13.906 Q 59.991 13.904 59.93 13.904 A 3.085 3.085 0 0 0 58.154 14.453 Q 57.398 14.958 56.96 16.101 A 7.022 7.022 0 0 0 56.689 16.992 L 53.125 30.713 L 48.389 2.881 A 3.655 3.655 0 0 0 47.952 1.68 A 3.272 3.272 0 0 0 47.168 0.781 A 3.39 3.39 0 0 0 46.086 0.163 A 3.136 3.136 0 0 0 45.215 0 Q 44.092 0 43.164 0.684 A 2.883 2.883 0 0 0 42.383 1.66 Q 42.074 2.145 41.925 3.109 A 8.86 8.86 0 0 0 41.895 3.32 L 37.402 29.492 L 33.35 10.449 A 3.394 3.394 0 0 0 32.178 8.496 A 2.937 2.937 0 0 0 30.322 7.764 A 3.571 3.571 0 0 0 30.152 7.76 A 3.267 3.267 0 0 0 28.418 8.252 Q 27.435 8.936 27.013 10.406 A 6.728 6.728 0 0 0 26.904 10.84 L 22.217 32.813 L 18.311 20.752 A 3.807 3.807 0 0 0 17.71 19.596 Q 16.87 18.525 15.283 18.457 A 4.724 4.724 0 0 0 15.087 18.453 Q 13.234 18.453 12.416 19.971 A 4.19 4.19 0 0 0 12.158 20.557 Q 12.109 20.654 12.061 20.85 L 11.084 24.316 Z" vector-effect="non-scaling-stroke"/></g></svg>
        <h2>When to seek medical attention</h2>
        <ul>
          <li>If your resting heart rate consistently falls below 60 BPM or exceeds 100 BPM (unless during exercise)</li>
          <li>You experience chest pain, shortness of breath, or irregular heartbeats.</li>
        </ul>
      </div>

    </div>
    
    <div class="chartCard chart1">
      <div class="chartBox">
        <canvas id="myChart"></canvas>
      </div>
    </div>
    <div class="chartCard chart2">
      <div class="chartBox">
        <canvas id="myChart2"></canvas>
      </div>
    </div>
    <button type="button" id="btn"><a href="#myFlex">Diagnose</a></button>
  </div>
  <div id="myFlex">
    <p id="status">Feedback</p>
    <p id="botResponse"></p>
</div>
  <script>
    document.addEventListener("DOMContentLoaded", (event) => {
      var bar2 = new ldBar("#myItem2");
      var bar3 = new ldBar("#myItem3");
    })
    // function getLocation(){
    //   console.log("ezzzz");
    //   if(navigator.geolocation){
    //     navigator.geolocation.getCurrentPosition( (coordinates) =>{
    //       sessionStorage.setItem("Latitude", coordinates.coords.latitude);
    //       sessionStorage.setItem("Longitude", coordinates.coords.longitude);
    //     })
    //   }
    //   else{
    //     sessionStorage.setItem("Message", "Location refused to be given");
    //   }
    // }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }
    document.addEventListener("DOMContentLoaded", function() {
      getLocation();
    });

    function showPosition(position) {
      // Store location data in session storage
      console.log(position.coords.latitude);
      sessionStorage.setItem("latitude", position.coords.latitude);
      sessionStorage.setItem("longitude", position.coords.longitude);
      // Use this data to find nearby hospitals (example explained below)
    }

    function showError(error) {
      console.error("Error:", error.message);
      alert("Geolocation access denied. Functionality limited.");
    }
      function fetchSensorData() {
        fetch('http://YourDomain.com/jsonfile.php')
          .then(response => response.json())
          .then(dataArray => {
            if (dataArray.length === 0) {
              console.log('No sensor data available.');
              return;
            }
            else {
                const latestData = dataArray[0];
              // Update your webpage elements with the latest data
              document.getElementById("myItem2").ldBar.set(latestData.spo2);
              document.getElementById("myItem3").ldBar.set(latestData.heartRate);
            }
          })
          .catch(error => {
            console.log('Error fetching sensor data: ' + error);
          });
      }
  
      // Fetch data initially and then at regular intervals
      document.addEventListener('DOMContentLoaded', function() {
        fetchSensorData();
        setInterval(fetchSensorData, 1000); // Fetch data every 1 second
      });
    </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script>
        <script type="importmap">
            {
              "imports": {
                "@google/generative-ai": "https://esm.run/@google/generative-ai"
              }
            }
          </script>
          <script type="module">
            import { GoogleGenerativeAI } from "@google/generative-ai";
      
            // Fetch your API_KEY
            const API_KEY = "Use-Your-Key";
      
            // Access your API key (see "Set up your API key" above)
            const genAI = new GoogleGenerativeAI(API_KEY);
      
            // ...
            const btn = document.getElementById("btn");
            async function run() {
                // For text-only input, use the gemini-pro model
                let currentHR = document.getElementById("myItem3").innerText;
                let currentSPO2 = document.getElementById("myItem2").innerText;
                let currentLongitude = sessionStorage.getItem("longitude");
                let currentLatitude = sessionStorage.getItem("latitude");
                const model = genAI.getGenerativeModel({ model: "gemini-pro"});
                const prompt = `Act as a doctor and diagnose the person whose vitals are as follows; Spo2=${currentSPO2}, BPM=${currentHR}. The result should contain considerations, recommendations. Also, recommend nearest hospitals patient should visit based on the following location information longitude = ${currentLongitude}, Latitude = ${currentLatitude} Kindly format the result in a visually applealing way`
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                document.getElementById("botResponse").innerText = text;
                document.getElementById("botResponse").classList.add('brder')
                console.log(text);
                const pdf = new jsPDF();
                const splitText = pdf.splitTextToSize(document.getElementById("botResponse").innerText, 180); // Adjust width as needed
                pdf.text(splitText, 10, 10);
                pdf.rect(5, 5, pdf.internal.pageSize.width - 10, pdf.internal.pageSize.height - 10, 'S');
    
                // pdf.text(document.getElementById("botResponse").innerText,10,10)
                pdf.save();
            }
            btn.addEventListener('click',run);
          </script>

<script src="mychart.js"></script>
<script type="text/javascript" src="loading-bar.js"></script>
</body>
</html>
